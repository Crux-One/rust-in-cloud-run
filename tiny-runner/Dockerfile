FROM rust:latest as builder

WORKDIR /usr/src/app
COPY . .

RUN rustup show

# This works with the dummy project generated by `cargo new app --bin`
RUN cargo build --release


# RUN rustup target add x86_64-unknown-linux-musl
# RUN apt update && apt install -y musl-tools musl-dev
# RUN apt-get install -y build-essential
# RUN yes | apt install gcc-x86-64-linux-gnu


# RUN cargo install --path .
# RUN rm ./target/release/deps/${SERVICE_NAME}*

# RUN rustup target add x86_64-unknown-linux-musl

# ENV RUSTFLAGS='-C linker=x86_64-linux-gnu-gcc'
# ENV CC_x86_64_unknown_linux_musl='x86_64-linux-gnu-gcc'


# SEE: https://cloud.google.com/run/docs/reference/container-contract
#  By default, requests are sent to 8080, but you can configure Cloud Run to send requests to the port of your choice.
ENV PORT 8080

EXPOSE 8080

ENTRYPOINT ["cargo", "run", "--release"]
